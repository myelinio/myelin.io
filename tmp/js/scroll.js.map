{"version":3,"file":"scroll.js","sourceRoot":"","sources":["../../src/ts/scroll.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2019 Istio Authors\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n// initialized after the DOM has been loaded\nlet scrollToTopButton: HTMLElement | null;\nlet tocLinks: HTMLCollectionOf<HTMLAnchorElement>;\nlet tocHeadings: HTMLElement[] = [];\nlet pageHeader: HTMLElement | null;\n\nfunction handleScroll(): void {\n    function dealWithScroll(): void {\n        // Based on the scroll position, make the \"scroll to top\" button visible or not\n        function controlScrollToTopButton(): void {\n            if (scrollToTopButton) {\n                if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {\n                    scrollToTopButton.classList.add(\"show\");\n                } else {\n                    scrollToTopButton.classList.remove(\"show\");\n                }\n            }\n        }\n\n        // Based on the scroll position, activate a TOC entry\n        function controlTOCActivation(): void {\n            if (tocLinks) {\n                let closestHeadingBelowTop = -1;\n                let closestHeadingBelowTopPos = 1000000;\n                let closestHeadingAboveTop = -1;\n                let closestHeadingAboveTopPos = -1000000;\n\n                for (let i = 0; i < tocLinks.length; i++) {\n                    const heading = tocHeadings[i];\n                    if (!heading) {\n                        continue;\n                    }\n\n                    // get the bounding rectangle of the heading's text area (ignores borders, margins, etc)\n                    const range = document.createRange();\n                    range.setStart(heading, 0);\n                    range.setEnd(heading, 1);\n                    const cbr = range.getBoundingClientRect();\n\n                    if (cbr.width || cbr.height) {\n                        if ((cbr.top >= pageHeaderHeight) && (cbr.top < window.innerHeight)) {\n                            // heading top is on the screen\n                            if (cbr.top + cbr.height - 1 < window.innerHeight) {\n                                // heading bottom is on the screen\n                                if (cbr.top + cbr.height - 1 < closestHeadingBelowTopPos) {\n                                    closestHeadingBelowTop = i;\n                                    closestHeadingBelowTopPos = cbr.top;\n                                }\n                            }\n                        } else if (cbr.top < pageHeaderHeight) {\n                            // heading is above the visible portion of the page\n                            if (cbr.top > closestHeadingAboveTopPos) {\n                                closestHeadingAboveTop = i;\n                                closestHeadingAboveTopPos = cbr.top;\n                            }\n                        }\n                    }\n\n                    tocLinks[i].classList.remove(\"current\");\n                }\n\n                if (closestHeadingBelowTop >= 0) {\n                    tocLinks[closestHeadingBelowTop].classList.add(\"current\");\n                } else if (closestHeadingAboveTop >= 0) {\n                    tocLinks[closestHeadingAboveTop].classList.add(\"current\");\n                }\n            }\n        }\n\n        const pageHeaderHeight = (pageHeader ? pageHeader.getBoundingClientRect().height : 0);\n\n        controlScrollToTopButton();\n        controlTOCActivation();\n\n        // HACK ALERT! When deep linking to a table row, the row ends up under the page header. This\n        // hack is here to detect that case and force-scroll the row into view.\n        //\n        // Note that this only works once for a given target row per page load. If the user is clicking\n        // around within a page, the second click to the same deep link will not trigger this hack and\n        // the user will be left with the row under the page header.\n        const target = document.querySelector<HTMLElement>(\":target\");\n        if (target && target.tagName === \"TR\" && !target.dataset.scrolled) {\n            document.documentElement.scrollTop -= pageHeaderHeight;\n            target.dataset.scrolled = \"true\";\n        }\n    }\n\n    // discover a few DOM elements up front so we don't need to do it a zillion times for the life of the page\n\n    scrollToTopButton = getById(\"scroll-to-top\");\n    listen(scrollToTopButton, click, () => {\n        // scroll the document to the top\n        document.body.scrollTop = 0;            // for Safari\n        document.documentElement.scrollTop = 0; // for Chrome, Firefox, IE and Opera\n    });\n\n    const toc = getById(\"toc\");\n    if (toc) {\n        tocLinks = toc.getElementsByTagName(\"a\");\n        for (const link of tocLinks) {\n            if (link) {\n                const id = decodeURIComponent(link.hash.substring(1));\n                const hdr = getById(id);\n                if (hdr) {\n                    tocHeadings.push(hdr);\n                }\n            }\n        }\n    }\n\n    pageHeader = document.getElementsByTagName(\"header\")[0];\n\n    // make sure things look right if we load a page to a specific anchor position\n    dealWithScroll();\n\n    // what we do when the user scrolls the page\n    listen(window, \"scroll\", dealWithScroll);\n}\n\nhandleScroll();\n"]}