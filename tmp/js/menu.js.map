{"version":3,"file":"menu.js","sourceRoot":"","sources":["../../src/ts/menu.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2019 Istio Authors\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n// Attach the event handlers to support menus\nfunction handleMenu(): void {\n    document.querySelectorAll<HTMLElement>(\".menu\").forEach(menu => {\n        const trigger = menu.querySelector<HTMLElement>(\".menu-trigger\");\n        const content = menu.querySelector<HTMLElement>(\".menu-content\");\n\n        if (!trigger || !content) {\n            // malformed menu\n            return;\n        }\n\n        // get all the menu items, setting role=\"menuitem\" and tabindex=\"-1\" along the way\n        const items: HTMLElement[] = [];\n        for (const el of content.children) {\n            const child = el as HTMLElement;\n            if (child.getAttribute(\"role\") === \"menuitem\") {\n                items.push(child);\n            }\n        }\n\n        const kbdnav = new KbdNav(items);\n\n        function focusTrigger() {\n            if (trigger) {\n                trigger.focus();\n            }\n        }\n\n        listen(trigger, click, e => {\n            toggleOverlay(menu);\n            toggleAttribute((e.currentTarget as HTMLElement), ariaExpanded);\n            e.cancelBubble = true;\n        });\n\n        listen(trigger, keydown, o => {\n            const e = o as KeyboardEvent;\n            const ch = e.key;\n\n            switch (e.keyCode) {\n                case keyCodes.SPACE:\n                case keyCodes.RETURN:\n                case keyCodes.DOWN:\n                    showOverlay(menu);\n                    kbdnav.focusFirstElement();\n                    break;\n\n                case keyCodes.UP:\n                    showOverlay(menu);\n                    kbdnav.focusLastElement();\n                    break;\n\n                default:\n                    if (isPrintableCharacter(ch)) {\n                        kbdnav.focusElementByChar(ch);\n                    }\n                    return;\n            }\n            e.stopPropagation();\n            e.preventDefault();\n        });\n\n        items.forEach(el => {\n            listen(el, keydown, o => {\n                const e = o as KeyboardEvent;\n                const ch = e.key;\n\n                if (e.ctrlKey || e.altKey || e.metaKey) {\n                    // nothing\n                } else if (e.shiftKey) {\n                    if (isPrintableCharacter(ch)) {\n                        kbdnav.focusElementByChar(ch);\n                    }\n                } else {\n                    switch (e.keyCode) {\n                        case keyCodes.SPACE:\n                            break;\n\n                        case keyCodes.RETURN:\n                            const evt = new MouseEvent(click, {\n                                bubbles: true,\n                                cancelable: true,\n                                clientX: 20,\n                                view: window,\n                            });\n                            el.dispatchEvent(evt);\n                            break;\n\n                        case keyCodes.ESC:\n                        case keyCodes.TAB:\n                            focusTrigger();\n                            closeActiveOverlay();\n                            return;\n\n                        case keyCodes.UP:\n                            kbdnav.focusPrevElement();\n                            break;\n\n                        case keyCodes.DOWN:\n                            kbdnav.focusNextElement();\n                            break;\n\n                        case keyCodes.HOME:\n                        case keyCodes.PAGEUP:\n                            kbdnav.focusFirstElement();\n                            break;\n\n                        case keyCodes.END:\n                        case keyCodes.PAGEDOWN:\n                            kbdnav.focusLastElement();\n                            break;\n\n                        default:\n                            if (isPrintableCharacter(ch)) {\n                                kbdnav.focusElementByChar(ch);\n                            }\n                            return;\n                    }\n                    e.stopPropagation();\n                    e.preventDefault();\n                }\n            });\n        });\n    });\n}\n\nhandleMenu();\n"]}